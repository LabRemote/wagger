"use strict";let A=new App,D=new Disp;function setup(){frameRate(A.FRAME_RATE),A.ntp.t1=parseInt(1e3*(new Date).valueOf()),httpGet(A.CLIENT_URL+"server_time.php","json",{},handle_server_time);let e={screen_layout_file:document.getElementById("screenLayoutFile").value};httpGet(A.CLIENT_URL+"get_screen_data.php","json",e,handle_display_data),A.img_url=A.FILES_URL+"0.png",A.img=loadImage(A.img_url,handle_image_loaded),A.img_width=1280/(720/A.STD_SCALE_HEIGHT),A.img_height=720/(720/A.STD_SCALE_HEIGHT),A.CANVAS=createCanvas(1500,800),A.CANVAS.parent("myContainer"),A.CANVAS.position(A.CANVAS_POS_X,A.CANVAS_POS_Y)}function draw(){if(A.frames_active++,A.frames_active<A.display_timeout*A.FRAME_RATE&&void 0!==A.DISPLAY_SELECT.style){if(A.DISPLAY_SELECT.style.visibility="visible",A.display_kiosk_interval>0&&A.frames_active%(A.display_kiosk_interval*A.FRAME_RATE)==0){A.display_index++,A.display_index>=D.data.length&&(A.display_index=0),A.DISPLAY_SELECT.value=A.display_index.toString();let e=new Event("change");A.DISPLAY_SELECT.dispatchEvent(e)}D.setDisplayTextProperties(A.display_index,A.hovered_clicked_label,A.ntp.adjustment,A.MAX_DISPLAY_DIGITS,A.text_element_alpha,255),A.frames_active-A.saved_frames>5&&(A.saved_frames=A.frames_active)}if(A.text_element_alpha=255,frameCount-A.last_time_sync>=A.NTP_SYNC_INTERVAL*A.FRAME_RATE&&A.frames_active<A.display_timeout*A.FRAME_RATE&&!1===A.display_is_static&&(A.ntp.t1=parseInt(1e3*(new Date).valueOf()),httpGet(A.CLIENT_URL+"server_time.php","json",{},handle_server_time),A.last_time_sync=frameCount),frameCount-A.last_request>=A.REQUEST_INTERVAL*A.FRAME_RATE&&A.frames_active<A.display_timeout*A.FRAME_RATE&&!1===A.display_is_static){if(""!==A.chan_index_string){let e={channels:A.chan_index_string,start_time:A.start_time,end_time:A.end_time,duration:A.time_bins,unit:A.time_bin_size,delete_horizon:3600};httpPost(A.CLIENT_URL+"send_request.php","json",e,handle_request_data)}if(""!==A.img_chan_index_string){let e={channels:A.img_chan_index_string,start_time:A.start_time,end_time:A.end_time,duration:A.time_bins,unit:A.time_bin_size,delete_horizon:3600};httpPost(A.CLIENT_URL+"send_request.php","json",e,handle_request_data)}A.last_request=frameCount}if(frameCount-A.last_get>=A.REQUEST_INTERVAL*A.FRAME_RATE&&A.frames_active<A.display_timeout*A.FRAME_RATE&&!1===A.display_is_static){if(""!==A.ctrl_chan_index_string){let e={channels:A.ctrl_chan_index_string,start_time:A.start_time,end_time:A.end_time,duration:-9999,unit:A.time_bin_size,lowest_status:1};httpPost(A.CLIENT_URL+"get_uploaded.php","json",e,handle_get_data)}if(""!==A.chan_index_string){let e={channels:A.chan_index_string,start_time:A.start_time,end_time:A.end_time,duration:A.time_bins,unit:A.time_bin_size,lowest_status:0};httpPost(A.CLIENT_URL+"get_uploaded.php","json",e,handle_get_data)}if(""!==A.img_chan_index_string){let e={channels:A.img_chan_index_string,start_time:A.start_time,end_time:A.end_time,duration:A.time_bins,unit:A.time_bin_size,lowest_status:0};httpPost(A.CLIENT_URL+"get_uploaded.php","json",e,handle_get_data)}A.last_get=frameCount}if(null!==A.pressed_send&&null!==A.moved_slider&&!1===A.display_is_static){let e={channels:A.moved_slider.id.split("_")[1]+";",start_time:A.start_time,end_time:A.end_time,value:A.moved_slider.value,duration:0,unit:1,delete_horizon:10};A.moved_slider=null,A.pressed_send=null,httpPost(A.CLIENT_URL+"send_request.php","json",e,handle_control_request_data)}if(A.ntp.timestamp=parseInt((new Date).valueOf()/1e3)+A.ntp.adjustment/1e6,void 0!==A.DISPLAY_SELECT.style&&!A.display_timed_out)if(A.frames_active>=A.display_timeout*A.FRAME_RATE)A.display_timed_out=!0,background(255),Disp.removeAllElements(A.CONTAINER),A.img=loadImage(A.FILES_URL+"000.jpg",handle_image_loaded),A.DISPLAY_TIMEOUT_TEXT=document.createElement("DIV"),A.CONTAINER.appendChild(A.DISPLAY_TIMEOUT_TEXT),A.DISPLAY_TIMEOUT_TEXT.innerHTML="Timeout due to inactivity - please reload page to continue data transfer!",Disp.setProperties(A.DISPLAY_TIMEOUT_TEXT.style,{width:parseInt(A.img_width).toString()+"px",height:parseInt(A.TIMEOUT_FONTSIZE).toString()+"px",position:"absolute",fontFamily:A.all_font_families,color:Disp.rGBALiteralFromArray(A.STANDARD_FOREGROUND_COLOR),textAlign:"left",visibility:"visible"}),reset_display_variables();else if(!1===A.display_is_static){A.DISPLAY_INFO_TEXT.innerHTML="",A.DISPLAY_INFO_TEXT.style.visibility="hidden";let e=A.ntp.timestamp-A.data_timestamp;if(e>A.time_bins*A.time_bin_size||!navigator.onLine)if(A.frames_active%2==0?A.DISPLAY_INFO_TEXT.style.color=Disp.rGBALiteralFromArray([255,0,0,127]):A.DISPLAY_INFO_TEXT.style.color=Disp.rGBALiteralFromArray([255,255,255,127]),!App.isValidNumber(e)||e>31536e4);else{let t=Disp.getTimeLagText(e),i="requesting new...";navigator.onLine||(i="no internet connection!"),A.DISPLAY_INFO_TEXT.innerHTML="Out of date ("+t+"), "+i,A.DISPLAY_INFO_TEXT.style.visibility="visible"}}}function handle_image_loaded(){let e={};e[0]=A.img;let t=D.data[A.display_index];if(void 0!==t){let i=t.screens[0],s=i.imgs.length;if(s>0)for(let t=0;t<s;t++){let s=e[t].width,l=e[t].height,n=i.imgs[t];if("source"===n.dim&&s>1&&l>1){A.display_kiosk_height>0&&(n.disp.h=A.display_kiosk_height);let e=l/n.disp.h;A.display_img_scale=n.disp.h/A.STD_SCALE_HEIGHT,A.img_height=l/e,A.img_width=s/e}"center"===n.disp.pos&&(A.canvas_shift_x=Math.max(parseInt((A.display_viewport.w-A.img_width)/2),0),A.canvas_shift_y=Math.max(parseInt((A.display_viewport.h-A.img_height)/2),0))}let l=i.img_channels.length;if(l>0)for(let t=0;t<l;t++){let s=e[t].width,l=e[t].height,n=i.img_channels[t];if("source"===n.dim&&s>1&&l>1){A.display_kiosk_height>0&&(n.disp.h=A.display_kiosk_height);let e=l/n.disp.h;A.display_img_scale=n.disp.h/A.STD_SCALE_HEIGHT,A.img_height=l/e,A.img_width=s/e}"center"===n.disp.pos&&(A.canvas_shift_x=Math.max(parseInt((A.display_viewport.w-A.img_width)/2),0),A.canvas_shift_y=Math.max(parseInt((A.display_viewport.h-A.img_height)/2),0))}Disp.setProperties(A.DISPLAY_INFO_TEXT.style,{fontSize:parseInt(A.WARNING_FONTSIZE*A.display_img_scale/A.display_img_scale).toString()+"px",left:parseInt(A.CANVAS_POS_X+A.canvas_shift_x+Math.max(A.img_width/2-8*A.WARNING_FONTSIZE,0)).toString()+"px",top:parseInt(A.CANVAS_POS_Y+A.canvas_shift_y+A.img_height/2-A.WARNING_FONTSIZE/2).toString()+"px"}),A.display_timed_out&&Disp.setProperties(A.DISPLAY_TIMEOUT_TEXT.style,{left:parseInt(A.CANVAS_POS_X+A.canvas_shift_x+Math.max(A.img_width/2-26*A.TIMEOUT_FONTSIZE+130,0)).toString()+"px",top:parseInt(A.CANVAS_POS_Y+A.canvas_shift_y+A.img_height/2-A.TIMEOUT_FONTSIZE/2).toString()+"px",fontSize:parseInt(A.TIMEOUT_FONTSIZE).toString()+"px"});let n=i.time;if(null!==n){let e=n.disp,t=Disp.getChannelElement(["timebkg",null]);null!==t&&Disp.setProperties(t.style,{fontSize:parseInt(e.size*A.display_img_scale/A.display_img_scale).toString()+"px",left:(e.pos.x*A.display_img_scale+A.CANVAS_POS_X+A.canvas_shift_x-e.size/2+1).toString()+"px",top:(e.pos.y*A.display_img_scale+A.CANVAS_POS_Y+A.canvas_shift_y-e.size+1).toString()+"px"})}let a=i.channels.length;if(a>0)for(let e=0;e<a;e++){let t=i.channels[e],s=t.disp,l=Disp.getChannelElement(["chanbkg",t.index]);null!==l&&Disp.setProperties(l.style,{fontSize:parseInt(s.size*A.display_img_scale/A.display_img_scale).toString()+"px",left:parseInt(s.pos.x*A.display_img_scale+A.CANVAS_POS_X+A.canvas_shift_x-s.size/2+1).toString()+"px",top:parseInt(s.pos.y*A.display_img_scale+A.CANVAS_POS_Y+A.canvas_shift_y-s.size+1).toString()+"px"})}let _=i.ctrl_channels.length;if(_>0)for(let e=0;e<_;e++){let t=i.ctrl_channels[e],s=t.disp,l=Disp.getChannelElement(["ctrlbkg",t.index]);null!==l&&Disp.setProperties(l.style,{fontSize:parseInt(s.size*A.display_img_scale/A.display_img_scale).toString()+"px",left:parseInt(s.pos.x*A.display_img_scale+A.CANVAS_POS_X+A.canvas_shift_x-s.size/2+7).toString()+"px",top:parseInt(s.pos.y*A.display_img_scale+A.CANVAS_POS_Y+A.canvas_shift_y-s.size+14).toString()+"px"})}}for(let t=0;t<=0;t++)image(e[t],A.canvas_shift_x,A.canvas_shift_y,A.img_width*(1-.5*t),A.img_height*(1-.5*t))}function handle_server_time(e){A.ntp.t2=parseInt(e.receivetime/1),A.ntp.t3=parseInt(e.transmittime/1),A.ntp.t4=parseInt(1e3*(new Date).valueOf()),A.ntp.adjustment=parseInt((A.ntp.t2-A.ntp.t1+(A.ntp.t3-A.ntp.t4))/2)}function handle_control_request_data(e){}function handle_request_data(e){}function handle_image_request_data(e){}function handle_get_data(e){let t=e.returnstring.split(";"),i=(t.length-1)/2,s="",l="",n=l.split(","),a=[],_=[];for(let e=0;e<i;e++){s=t[2*e];let i=((n=(l=t[2*e+1]).split(",")).length-1)/4-0,r=[],A=[],p=[];for(let e=0;e<i;e++)r[e]=parseInt(n[4*e+0]),A[e]=parseFloat(n[4*e+1]),p[e]=n[4*e+3];a.push(r);let d=parseInt(s);_.push([d,A])}populate_display_variables(a,_),A.text_element_alpha=127}function populate_display_variables(e,t){let i=A.ntp.timestamp;if(App.isValidGT(i,0)){A.server_timestamp=i;let s=new Date(1e3*i),l="";App.isValidDate(s)?(l=s.toISOString(),A.ntp.time_string=l.substring(0,10).concat(" ",l.substring(11,19)," ",A.TIME_ZONE),A.server_time_string=A.ntp.time_string):A.server_time_string=A.WAIT_MESSAGE;let n=D.data[A.display_index].screens[0],a=n.time;null!==a&&(a.str_val=A.server_time_string,a.val=A.server_timestamp);let _=App.nthMaxOfArray(e[0],0);if(App.isValidGT(_,0)){A.data_timestamp=_;let e=new Date(1e3*_),i="";App.isValidDate(e)?(i=e.toISOString(),A.data_time_string=i.substring(0,10).concat(" ",i.substring(11,19)," ",A.TIME_ZONE)):A.data_time_string=A.WAIT_MESSAGE;for(let e=0;e<n.img_channels.length;e++){let t=n.img_channels[e],i=A.FILES_URL+t.index.toString()+"_"+_.toString()+"."+t.ext;A.img_url=i,A.img=loadImage(i,handle_image_loaded)}for(let e=0;e<n.channels.length;e++){let i=n.channels[e],s=App.findWithAttr(t,0,i.index);if(s>-1){let e=t[s][1],l=e[e.length-1];i.val=l*i.scale,App.isValidNumber(i.val)?i.str_val=i.val.toString().substring(0,i.disp.len)+" "+i.unit:i.str_val=A.WAIT_MESSAGE}}for(let e=0;e<n.ctrl_channels.length;e++){let i=n.ctrl_channels[e],s=App.findWithAttr(t,0,i.index);if(s>-1){let e=t[s][1],l=e[e.length-1];i.val=l*i.scale,App.isValidNumber(i.val)?i.str_val=i.val.toString().substring(0,i.disp.len)+" "+i.unit:i.str_val=A.WAIT_MESSAGE}}}}}function reset_display_variables(){A.server_time_string=A.WAIT_MESSAGE,A.data_timestamp=A.ntp.timestamp;let e=D.data[A.display_index].screens[0];if(null!==e.time){A.display_is_static=!1;for(let t=0;t<e.channels.length;t++)e.channels[t].str_val=A.WAIT_MESSAGE}else A.display_is_static=!0}function mousePressed(){}function circle_button(e,t,i){dist(mouseX,mouseY,e,t);ellipseMode(CENTER),stroke(0,0),strokeWeight(i/4),stroke(0,0),ellipse(e,t,i,i)}function handle_display_data(e){D.data=e.displays,void 0!==e.disp_timeout&&(A.display_timeout=e.disp_timeout),void 0!==e.disp_viewport_size&&(A.display_viewport=e.disp_viewport_size),void 0!==e.disp_override_font&&(A.display_override_font=e.disp_override_font),void 0!==e.disp_kiosk_interval&&(A.display_kiosk_interval=e.disp_kiosk_interval),void 0!==e.disp_kiosk_adjust&&(A.display_kiosk_adjust=e.disp_kiosk_adjust),void 0!==e.disp_kiosk_override_height&&(A.display_kiosk_height=e.disp_kiosk_override_height),document.title="LabRemote",A.CONTAINER=document.getElementById("myContainer"),A.all_font_families=Disp.addFonts([A.display_override_font.filename],A.display_override_font.path)+", "+A.STANDARD_FONT_FAMILIES,A.DISPLAY_SELECT=document.createElement("SELECT"),A.DISPLAY_SELECT.id="screen_select",A.CONTAINER.appendChild(A.DISPLAY_SELECT);for(let e=0;e<D.data.length;e++)A.DISPLAY_SELECT.options[A.DISPLAY_SELECT.options.length]=new Option(D.data[e].title,e);A.DISPLAY_SELECT.addEventListener("change",display_select_listener),Disp.setProperties(A.DISPLAY_SELECT.style,{position:"absolute",left:"10px",top:"10px",visibility:"hidden"}),display_select_listener()}function label_listener(){let e=this;if(void 0!==e){A.hovered_clicked_label=e,e.style.visibility="visible";let[t,i]=Disp.getTagChannelIndex(e);if("timebkg"===t){let e=Disp.getChannelElement(["timelabel",null]);if(null!==e){e.style.visibility="visible";let t=D.data[A.display_index].screens[0].time,i=t.str_val+t.info;e.innerHTML=i+(-A.ntp.adjustment/1e6).toString().substring(0,7)+" s"}}let s=Disp.getChannelElement(["setval",i]);if(null!==s){s.style.visibility="visible";let e=D.data[A.display_index].screens[0].ctrl_channels,t=e[App.findWithAttr(e,"index",parseInt(i))],l="",n=(l=""!==t.str_val?t.str_val:(t.val*t.scale).toString().substring(0,t.disp.len)+" "+t.unit)+t.info;s.innerHTML=n;let a=Disp.getChannelElement(["slider",i]);null!==a&&(a.style.visibility="visible",a.value=t.val);let _=Disp.getChannelElement(["send",i]);null!==_&&(_.style.visibility="visible")}let l=Disp.getChannelElement(["label",i]);if(null!==l){l.style.visibility="visible";let e=D.data[A.display_index].screens[0].channels,t=e[App.findWithAttr(e,"index",parseInt(i))],s="",n=(s=t.val.toString().substring(0,A.MAX_DISPLAY_DIGITS)+" "+t.unit)+t.info;l.innerHTML=n}}}function outside_label_listener(){let e=this;if(void 0!==e){A.hovered_clicked_label=null,e.style.visibility="hidden";let[t,i]=Disp.getTagChannelIndex(e);if("timebkg"===t){let e=Disp.getChannelElement(["timelabel",null]);if(null!==e){let t=D.data[A.display_index].screens[0].time.str_val;e.innerHTML=t+Disp.htmlSpaces(0)+"<br>"+Disp.htmlSpaces(10)}}let s=Disp.getChannelElement(["send",i]);null!==s&&(s.style.visibility="hidden");let l=Disp.getChannelElement(["slider",i]);null!==l&&(l.style.visibility="hidden");let n=Disp.getChannelElement(["setval",i]);if(null!==n){let e=D.data[A.display_index].screens[0].ctrl_channels,t=e[App.findWithAttr(e,"index",parseInt(i))],s="";s=""!==t.str_val?t.str_val:(t.val*t.scale).toString().substring(0,t.disp.len)+" "+t.unit,n.innerHTML=s+Disp.htmlSpaces(0)+"<br>"+Disp.htmlSpaces(10)}let a=Disp.getChannelElement(["label",i]);if(null!==a){let e=D.data[A.display_index].screens[0].channels,t=e[App.findWithAttr(e,"index",parseInt(i))],s="";s=""!==t.str_val?t.str_val:(t.val*t.scale).toString().substring(0,t.disp.len)+" "+t.unit,a.innerHTML=s+Disp.htmlSpaces(0)+"<br>"+Disp.htmlSpaces(10)}}}function send_listener(){let e=this;void 0!==e&&(e.disabled=!0,e.style.opacity="0.5",A.pressed_send=e)}function slider_listener(){let e=this;if(void 0!==e){let[t,i]=Disp.getTagChannelIndex(e),s=Disp.getChannelElement(["setval",i]),l=Disp.getChannelElement(["send",i]),n=parseInt(i),a=parseFloat(e.value);l.disabled=!1,l.style.opacity="1.0";let _=[],r=D.data[A.display_index].screens[0].ctrl_channels;for(let e=0;e<r.length;e++)r[e].index===n&&(_=r[e]);let p="";""!==_.min_str_val&&""!==_.max_str_val&&""!==_.str_val?(p=_.min_str_val,a>.5&&(p=_.max_str_val)):p=(a*_.scale).toString().substring(0,_.disp.len)+" "+_.unit,_.str_val=p,_.val=a,p+=_.info,s.innerHTML=p,A.moved_slider=e}}function display_select_listener(){if(!A.display_timed_out){if(background(255),A.saved_frames=0,0===A.display_kiosk_interval)A.frames_active=0;else{let e=A.display_kiosk_adjust;window.scrollTo(A.CANVAS_POS_X+e.x,A.CANVAS_POS_Y+e.y)}A.channel_strings_array=[],Disp.removeAllElements(A.CONTAINER),A.display_index=parseInt(A.DISPLAY_SELECT.options[A.DISPLAY_SELECT.selectedIndex].value);let e=D.data[A.display_index].screens[0],t=e.imgs.length;if(t>0)for(let i=0;i<t;i++){let t=e.imgs[i];if(0===i&&(A.img_url=A.FILES_URL+t.file.toString()),A.img=loadImage(A.img_url,handle_image_loaded),"center"!==t.disp.pos&&(A.canvas_shift_x=t.disp.pos.x,A.canvas_shift_y=t.disp.pos.y),"source"!==t.dim){let e=t.dim.w,i=t.dim.h;A.display_kiosk_height>0&&(t.disp.h=A.display_kiosk_height);let s=i/t.disp.h;A.display_img_scale=t.disp.h/A.STD_SCALE_HEIGHT,A.img_height=i/s,A.img_width=e/s}}else A.img_url=A.FILES_URL+"00.jpg",A.img=loadImage(A.img_url,handle_image_loaded);A.DISPLAY_INFO_TEXT=document.createElement("DIV"),A.CONTAINER.appendChild(A.DISPLAY_INFO_TEXT),Disp.setProperties(A.DISPLAY_INFO_TEXT.style,{width:parseInt(A.img_width).toString()+"px",height:parseInt(A.WARNING_FONTSIZE).toString()+"px",position:"absolute",left:parseInt(A.CANVAS_POS_X+A.canvas_shift_x+Math.max(A.img_width/2-7*A.WARNING_FONTSIZE,0)).toString()+"px",top:parseInt(A.CANVAS_POS_Y+A.canvas_shift_y+A.img_height/2-A.WARNING_FONTSIZE/2).toString()+"px",fontSize:parseInt(A.WARNING_FONTSIZE*A.display_img_scale/A.display_img_scale).toString()+"px",fontFamily:A.all_font_families,textAlign:"left",visibility:"hidden"}),A.DISPLAY_INFO_TEXT.id="infotext";let i=e.time;if(null!==i){A.time_bins=i.bins,A.time_bin_size=i.bin_size;let e=i.disp,t=e.col,s=e.bgcol,l=document.createElement("DIV");A.CONTAINER.appendChild(l);let n=document.createElement("BUTTON");l.appendChild(n),n.innerHTML="";let a=document.createTextNode("");n.appendChild(a),l.title="",Disp.setProperties(l.style,{width:(14.1*e.size).toString()+"px",height:(4.1*e.size+4).toString()+"px",position:"absolute",left:(e.pos.x*A.display_img_scale+A.CANVAS_POS_X+A.canvas_shift_x-e.size/2+1).toString()+"px",top:(e.pos.y*A.display_img_scale+A.CANVAS_POS_Y+A.canvas_shift_y-e.size+1).toString()+"px",visibility:"hidden",fontSize:parseInt(e.size*A.display_img_scale/A.display_img_scale).toString()+"px",fontFamily:A.all_font_families,color:Disp.rGBALiteralFromArray([t.r,t.g,t.b,t.a]),backgroundColor:Disp.rGBALiteralFromArray([s.r,s.g,s.b,s.a])}),n.title="",Disp.setProperties(n.style,{position:"absolute",left:(.33*e.size).toString()+"px",top:(.34*e.size).toString()+"px",visibility:"visible",fontSize:parseInt(e.size*A.display_img_scale/A.display_img_scale).toString()+"px",fontFamily:A.all_font_families,color:Disp.rGBALiteralFromArray([t.r,t.g,t.b,t.a]),backgroundColor:"transparent",border:"transparent",outline:"none",textAlign:"left"}),l.id="timebkg",n.id="timelabel",l.addEventListener("mouseover",label_listener),l.addEventListener("mouseleave",outside_label_listener),i.info=Disp.htmlSpaces(0)+"<br>Last server response (NTP)<br>Client time offset: ",i.padding=Disp.htmlSpaces(5)+"<br>"+Disp.htmlSpaces(10)}let s=e.channels.length;A.chan_index_string="";for(let t=0;t<s;t++){let i=e.channels[t],s=i.disp,l=s.bgcol,n=s.col,a=i.index.toString();A.chan_index_string+=a+";";let _=document.createElement("DIV");A.CONTAINER.appendChild(_);let r=document.createElement("BUTTON");_.appendChild(r),r.innerHTML="";let p=document.createTextNode("");r.appendChild(p),_.title="",Disp.setProperties(_.style,{width:(13.9*s.size).toString()+"px",height:(4.1*s.size+4).toString()+"px",position:"absolute",left:(s.pos.x*A.display_img_scale+A.CANVAS_POS_X+A.canvas_shift_x-s.size/2+1).toString()+"px",top:(s.pos.y*A.display_img_scale+A.CANVAS_POS_Y+A.canvas_shift_y-s.size+1).toString()+"px",visibility:"hidden",fontSize:parseInt(s.size*A.display_img_scale).toString()+"px",fontFamily:A.all_font_families,color:Disp.rGBALiteralFromArray([n.r,n.g,n.b,n.a]),backgroundColor:Disp.rGBALiteralFromArray([l.r,l.g,l.b,l.a])}),r.title="",Disp.setProperties(r.style,{position:"absolute",left:(.33*s.size).toString()+"px",top:(.34*s.size).toString()+"px",visibility:"visible",fontSize:parseInt(s.size*A.display_img_scale/A.display_img_scale).toString()+"px",fontFamily:A.all_font_families,color:Disp.rGBALiteralFromArray([n.r,n.g,n.b,n.a]),backgroundColor:"transparent",border:"transparent",outline:"none",textAlign:"left"}),_.id="chanbkg_"+a,r.id="label_"+a,_.addEventListener("mouseover",label_listener),_.addEventListener("mouseleave",outside_label_listener),i.info=Disp.htmlSpaces(0)+"<br>"+i.label.toString()+"<br>Measurement channel "+a,i.padding=Disp.htmlSpaces(5)+"<br>"+Disp.htmlSpaces(10)}let l=e.img_channels.length;A.img_chan_index_string="";for(let t=0;t<l;t++){let i=e.img_channels[t],s=i.index.toString();if(A.img_chan_index_string+=s+";","center"!==i.disp.pos&&(A.canvas_shift_x=i.disp.pos.x,A.canvas_shift_y=i.disp.pos.y),"source"!==i.dim){let e=i.dim.w,t=i.dim.h;A.display_kiosk_height>0&&(i.disp.h=A.display_kiosk_height);let s=t/i.disp.h;A.display_img_scale=i.disp.h/A.STD_SCALE_HEIGHT,A.img_height=t/s,A.img_width=e/s}}let n=e.ctrl_channels.length;A.ctrl_chan_index_string="";for(let t=0;t<n;t++){let i=e.ctrl_channels[t],s=i.index.toString();A.ctrl_chan_index_string+=s+";";let l=document.createElement("DIV");A.CONTAINER.appendChild(l);let n=document.createElement("INPUT"),a=document.createElement("BUTTON"),_=document.createElement("BUTTON");l.appendChild(n),l.appendChild(a),l.appendChild(_);let r=document.createTextNode("");a.appendChild(r),l.id="ctrlbkg_"+s,n.id="slider_"+s,a.id="setval_"+s,_.id="send_"+s,l.addEventListener("mouseover",label_listener),l.addEventListener("mouseleave",outside_label_listener);let p=i.disp,d=p.col,o=p.bgcol;l.title="",Disp.setProperties(l.style,{width:(10.8*p.size).toString()+"px",height:(8.2*p.size).toString()+"px",position:"absolute",left:(p.pos.x*A.display_img_scale+A.CANVAS_POS_X+A.canvas_shift_x-p.size/2+7).toString()+"px",top:(p.pos.y*A.display_img_scale+A.CANVAS_POS_Y+A.canvas_shift_y-p.size+14).toString()+"px",visibility:"hidden",fontSize:parseInt(p.size*A.display_img_scale/A.display_img_scale).toString()+"px",fontFamily:A.all_font_families,color:Disp.rGBALiteralFromArray([d.r,d.g,d.b,d.a]),backgroundColor:Disp.rGBALiteralFromArray([o.r,o.g,o.b,o.a])}),n.title="",Disp.setProperties(n.style,{width:(9*p.size).toString()+"px",height:(1.8*p.size).toString()+"px",position:"absolute",left:(.7*p.size).toString()+"px",top:(.6*p.size).toString()+"px",visibility:"hidden",fontSize:parseInt(p.size*A.display_img_scale/A.display_img_scale).toString()+"px",fontFamily:A.all_font_families}),a.title="",Disp.setProperties(a.style,{position:"absolute",left:(.38*p.size).toString()+"px",top:(3*p.size).toString()+"px",visibility:"visible",fontSize:parseInt(p.size*A.display_img_scale/A.display_img_scale).toString()+"px",fontFamily:A.all_font_families,color:Disp.rGBALiteralFromArray([d.r,d.g,d.b,d.a]),backgroundColor:"transparent",border:"transparent",outline:"none",textAlign:"left"}),_.title="",_.disabled=!0,Disp.setProperties(_.style,{width:(2.7*p.size).toString()+"px",height:(1.6*p.size).toString()+"px",position:"absolute",left:(7.3*p.size).toString()+"px",top:(3.1*p.size).toString()+"px",visibility:"hidden",fontSize:parseInt(p.size*A.display_img_scale/A.display_img_scale).toString()+"px",fontFamily:A.all_font_families,borderRadius:"10%",opacity:"0.5",textAlign:"center"}),Disp.setProperties(n,{type:"range",min:i.min_val,max:i.max_val,step:i.val_step,value:i.val}),n.addEventListener("input",slider_listener);let m="";""!==i.min_str_val&&""!==i.max_str_val&&""!==i.str_val?(Disp.setProperties(n,{min:0,max:1,step:1,value:0}),m=i.min_str_val):m=(i.val*i.scale).toString().substring(0,i.disp.len)+" "+i.unit,Disp.setProperties(i,{str_val:m,info:Disp.htmlSpaces(0)+"<br>"+Disp.htmlSpaces(10)+"<br>"+i.label.toString()+"<br>Control channel "+s,padding:Disp.htmlSpaces(0)+"<br>"+Disp.htmlSpaces(10)+"<br>"+Disp.htmlSpaces(10)}),a.innerHTML=m+i.padding,_.addEventListener("click",send_listener),_.innerHTML="Go"}reset_display_variables()}}