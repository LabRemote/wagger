"use strict";let App=new AppData,Display=new DisplayData;function setup(){frameRate(App.FRAME_RATE),App.ntp.t1=parseInt(1e3*(new Date).valueOf()),httpGet(App.CLIENT_URL+"server_time.php","json",{},handle_server_time);let t={screen_layout_file:document.getElementById("screenLayoutFile").value};httpGet(App.CLIENT_URL+"get_screen_data.php","json",t,handle_display_data),App.img_url=App.FILES_URL+"0.png",App.img=loadImage(App.img_url,handle_image_loaded),App.img_width=1280/(720/App.STD_SCALE_HEIGHT),App.img_height=720/(720/App.STD_SCALE_HEIGHT),App.CANVAS=createCanvas(1500,800),App.CANVAS.parent("myContainer"),App.CANVAS.position(App.CANVAS_POS_X,App.CANVAS_POS_Y),App.all_font_families=addFonts(["carlito.woff"],"/fonts/")+", "+App.STANDARD_FONT_FAMILIES}function draw(){if(App.frames_active++,App.frames_active<App.display_timeout*App.FRAME_RATE&&void 0!==App.DISPLAY_SELECT.style){if(App.DISPLAY_SELECT.style.visibility="visible",App.display_kiosk_interval>0&&App.frames_active%(App.display_kiosk_interval*App.FRAME_RATE)==0){App.display_index++,App.display_index>=Display.data.length&&(App.display_index=0),App.DISPLAY_SELECT.value=App.display_index.toString();let t=new Event("change");App.DISPLAY_SELECT.dispatchEvent(t)}let t=null;if(void 0!==Display.data[App.display_index]&&(t=Display.data[App.display_index].screens[0]),null!==t){let e="",i="";null!==App.hovered_clicked_label&&([e,i]=getTagChannelIndex(App.hovered_clicked_label));let p=t.time;if(null!==p){let t=getChannelElement(["timelabel",null]);t.innerHTML=p.str_val+p.padding,"timebkg"===e&&(t.innerHTML=p.str_val+p.info+(-App.ntp.adjustment/1e6).toString().substring(0,7)+" s")}for(let e=0;e<t.channels.length;e++){let p=t.channels[e],s=p.index.toString(),n=getChannelElement(["label",s]);n.innerHTML=p.str_val+p.padding,i===s&&(n.innerHTML=p.val.toString().substring(0,App.MAX_DISPLAY_DIGITS)+" "+p.unit+p.info)}for(let e=0;e<t.img_channels.length;e++);for(let e=0;e<t.ctrl_channels.length;e++){let p=t.ctrl_channels[e],s=p.index.toString(),n=getChannelElement(["setval",s]);if(n.innerHTML=p.str_val+p.padding,i===s){n.innerHTML=p.str_val+p.info,getChannelElement(["slider",s]).value=p.val}}}}if(frameCount-App.last_time_sync>=App.NTP_SYNC_INTERVAL*App.FRAME_RATE&&App.frames_active<App.display_timeout*App.FRAME_RATE&&!1===App.display_is_static&&(App.ntp.t1=parseInt(1e3*(new Date).valueOf()),httpGet(App.CLIENT_URL+"server_time.php","json",{},handle_server_time),App.last_time_sync=frameCount),frameCount-App.last_request>=App.REQUEST_INTERVAL*App.FRAME_RATE&&App.frames_active<App.display_timeout*App.FRAME_RATE&&!1===App.display_is_static){if(""!==App.chan_index_string){let t={channels:App.chan_index_string,start_time:App.start_time,end_time:App.end_time,duration:App.time_bins,unit:App.time_bin_size,delete_horizon:3600};httpPost(App.CLIENT_URL+"send_request.php","json",t,handle_request_data)}if(""!==App.img_chan_index_string){let t={channels:App.img_chan_index_string,start_time:App.start_time,end_time:App.end_time,duration:App.time_bins,unit:App.time_bin_size,delete_horizon:3600};httpPost(App.CLIENT_URL+"send_request.php","json",t,handle_request_data)}App.last_request=frameCount}if(frameCount-App.last_get>=App.REQUEST_INTERVAL*App.FRAME_RATE&&App.frames_active<App.display_timeout*App.FRAME_RATE&&!1===App.display_is_static){if(""!==App.ctrl_chan_index_string){let t={channels:App.ctrl_chan_index_string,start_time:App.start_time,end_time:App.end_time,duration:-9999,unit:App.time_bin_size,lowest_status:1};httpPost(App.CLIENT_URL+"get_uploaded.php","json",t,handle_get_data)}if(""!==App.chan_index_string){let t={channels:App.chan_index_string,start_time:App.start_time,end_time:App.end_time,duration:App.time_bins,unit:App.time_bin_size,lowest_status:0};httpPost(App.CLIENT_URL+"get_uploaded.php","json",t,handle_get_data)}if(""!==App.img_chan_index_string){let t={channels:App.img_chan_index_string,start_time:App.start_time,end_time:App.end_time,duration:App.time_bins,unit:App.time_bin_size,lowest_status:0};httpPost(App.CLIENT_URL+"get_uploaded.php","json",t,handle_get_data)}App.last_get=frameCount}if(null!==App.pressed_send&&null!==App.moved_slider&&!1===App.display_is_static){let t={channels:App.moved_slider.id.split("_")[1]+";",start_time:App.start_time,end_time:App.end_time,value:App.moved_slider.value,duration:0,unit:1,delete_horizon:10};App.moved_slider=null,App.pressed_send=null,httpPost(App.CLIENT_URL+"send_request.php","json",t,handle_control_request_data)}if(App.ntp.timestamp=parseInt((new Date).valueOf()/1e3)+App.ntp.adjustment/1e6,void 0!==App.DISPLAY_SELECT.style&&!App.display_timed_out)if(App.frames_active>=App.display_timeout*App.FRAME_RATE)App.display_timed_out=!0,background(255),removeAllElements(App.CONTAINER),App.img=loadImage(App.FILES_URL+"000.jpg",handle_image_loaded),App.img_width=1280/(720/App.STD_SCALE_HEIGHT),App.img_height=720/(720/App.STD_SCALE_HEIGHT),App.DISPLAY_INFO_TEXT=document.createElement("DIV"),App.CONTAINER.appendChild(App.DISPLAY_INFO_TEXT),App.DISPLAY_INFO_TEXT.innerHTML="Timeout due to inactivity - please reload page to continue data transfer!",setAttributes(App.DISPLAY_INFO_TEXT.style,{width:parseInt(App.img_width).toString()+"px",height:parseInt(App.WARNING_FONTSIZE).toString()+"px",position:"absolute",left:parseInt(App.CANVAS_POS_X+App.canvas_shift_x+Math.max(App.img_width/2-7*App.WARNING_FONTSIZE,0)).toString()+"px",top:parseInt(App.CANVAS_POS_Y+App.canvas_shift_y+App.img_height/2-App.WARNING_FONTSIZE/2).toString()+"px",fontSize:parseInt(16*App.display_img_scale).toString()+"px",fontFamily:App.all_font_families,color:getRGBALiteral(App.STANDARD_FOREGROUND_COLOR),textAlign:"left",visibility:"visible"}),reset_display_variables();else if(!1===App.display_is_static){App.DISPLAY_INFO_TEXT.innerHTML="",App.DISPLAY_INFO_TEXT.style.visibility="hidden";let t=App.ntp.timestamp-App.data_timestamp;if(t>App.time_bins*App.time_bin_size||!navigator.onLine)if(App.frames_active%2==0?App.DISPLAY_INFO_TEXT.style.color=getRGBALiteral([255,0,0,127]):App.DISPLAY_INFO_TEXT.style.color=getRGBALiteral([255,255,255,127]),!isValidNumber(t)||t>31536e4);else{let e=getTimeLagText(t),i="requesting new...";navigator.onLine||(i="no internet connection!"),App.DISPLAY_INFO_TEXT.innerHTML="Out of date ("+e+"), "+i,App.DISPLAY_INFO_TEXT.style.visibility="visible"}}}function handle_image_loaded(){let t={};t[0]=App.img;let e=Display.data[App.display_index];if(void 0!==e){let i=e.screens[0],p=i.imgs.length;if(p>0)for(let e=0;e<p;e++){let p=t[e].width,s=t[e].height,n=i.imgs[e];if("source"===n.dim){let t=s/n.disp.h;App.display_img_scale=n.disp.h/App.STD_SCALE_HEIGHT,App.display_kiosk_height>0&&(t=s/App.display_kiosk_height),App.img_height=s/t,App.img_width=p/t}"center"===n.disp.pos&&(App.canvas_shift_x=Math.max(parseInt((App.display_viewport.w-App.img_width)/2),0),App.canvas_shift_y=Math.max(parseInt((App.display_viewport.h-App.img_height)/2),0))}let s=i.img_channels.length;if(s>0)for(let e=0;e<s;e++){let p=t[e].width,s=t[e].height,n=i.img_channels[e];if("source"===n.dim){let t=s/n.disp.h;App.display_img_scale=n.disp.h/App.STD_SCALE_HEIGHT,App.display_kiosk_height>0&&(t=s/App.display_kiosk_height),App.img_height=s/t,App.img_width=p/t}"center"===n.disp.pos&&(App.canvas_shift_x=Math.max(parseInt((App.display_viewport.w-App.img_width)/2),0),App.canvas_shift_y=Math.max(parseInt((App.display_viewport.h-App.img_height)/2),0))}setAttributes(App.DISPLAY_INFO_TEXT.style,{fontSize:parseInt(App.WARNING_FONTSIZE*App.display_img_scale).toString()+"px",left:parseInt(App.CANVAS_POS_X+App.canvas_shift_x+Math.max(App.img_width/2-7*App.WARNING_FONTSIZE,0)).toString()+"px",top:parseInt(App.CANVAS_POS_Y+App.canvas_shift_y+App.img_height/2-App.WARNING_FONTSIZE/2).toString()+"px"});let n=i.time;if(null!==n){let t=n.disp,e=getChannelElement(["timebkg",null]);null!==e&&setAttributes(e.style,{fontSize:parseInt(t.size*App.display_img_scale).toString()+"px",left:(t.pos.x*App.display_img_scale+App.CANVAS_POS_X+App.canvas_shift_x-t.size/2+1).toString()+"px",top:(t.pos.y*App.display_img_scale+App.CANVAS_POS_Y+App.canvas_shift_y-t.size+1).toString()+"px"})}let l=i.channels.length;if(l>0)for(let t=0;t<l;t++){let e=i.channels[t],p=e.disp,s=getChannelElement(["chanbkg",e.index]);null!==s&&setAttributes(s.style,{fontSize:parseInt(p.size*App.display_img_scale).toString()+"px",left:parseInt(p.pos.x*App.display_img_scale+App.CANVAS_POS_X+App.canvas_shift_x-p.size/2+1).toString()+"px",top:parseInt(p.pos.y*App.display_img_scale+App.CANVAS_POS_Y+App.canvas_shift_y-p.size+1).toString()+"px"})}let a=i.ctrl_channels.length;if(a>0)for(let t=0;t<a;t++){let e=i.ctrl_channels[t],p=e.disp,s=getChannelElement(["ctrlbkg",e.index]);null!==s&&setAttributes(s.style,{fontSize:parseInt(p.size*App.display_img_scale).toString()+"px",left:parseInt(p.pos.x*App.display_img_scale+App.CANVAS_POS_X+App.canvas_shift_x-p.size/2+7).toString()+"px",top:parseInt(p.pos.y*App.display_img_scale+App.CANVAS_POS_Y+App.canvas_shift_y-p.size+14).toString()+"px"})}}for(let e=0;e<=0;e++)image(t[e],App.canvas_shift_x,App.canvas_shift_y,App.img_width*(1-.5*e),App.img_height*(1-.5*e))}function handle_server_time(t){App.ntp.t2=parseInt(t.receivetime/1),App.ntp.t3=parseInt(t.transmittime/1),App.ntp.t4=parseInt(1e3*(new Date).valueOf()),App.ntp.adjustment=parseInt((App.ntp.t2-App.ntp.t1+(App.ntp.t3-App.ntp.t4))/2)}function handle_control_request_data(t){}function handle_request_data(t){}function handle_image_request_data(t){}function handle_get_data(t){let e=t.returnstring.split(";"),i=(e.length-1)/2,p="",s="",n=s.split(","),l=[],a=[];for(let t=0;t<i;t++){p=e[2*t];let i=((n=(s=e[2*t+1]).split(",")).length-1)/4-0,_=[],r=[],A=[];for(let t=0;t<i;t++)_[t]=parseInt(n[4*t+0]),r[t]=parseFloat(n[4*t+1]),A[t]=n[4*t+3];l.push(_);let d=parseInt(p);a.push([d,r])}populate_display_variables(l,a)}function populate_display_variables(t,e){let i=App.ntp.timestamp;if(isValidGT(i,0)){App.server_timestamp=i;let p=new Date(1e3*i),s="";isValidDate(p)?(s=p.toISOString(),App.ntp.time_string=s.substring(0,10).concat(" ",s.substring(11,19)," ",App.TIME_ZONE),App.server_time_string=App.ntp.time_string):App.server_time_string=App.WAIT_MESSAGE;let n=Display.data[App.display_index].screens[0],l=n.time;null!==l&&(l.str_val=App.server_time_string,l.val=App.server_timestamp);let a=nthMaxOfArray(t[0],0);if(isValidGT(a,0)){App.data_timestamp=a;let t=new Date(1e3*a),i="";isValidDate(t)?(i=t.toISOString(),App.data_time_string=i.substring(0,10).concat(" ",i.substring(11,19)," ",App.TIME_ZONE)):App.data_time_string=App.WAIT_MESSAGE;for(let t=0;t<n.img_channels.length;t++){let e=n.img_channels[t],i=App.FILES_URL+e.index.toString()+"_"+a.toString()+"."+e.ext;App.img_url=i,App.img=loadImage(i,handle_image_loaded)}for(let t=0;t<n.channels.length;t++){let i=n.channels[t],p=findWithAttr(e,0,i.index);if(p>-1){let t=e[p][1],s=t[t.length-1];i.val=s*i.scale,isValidNumber(i.val)?i.str_val=i.val.toString().substring(0,i.disp.len)+" "+i.unit:i.str_val=App.WAIT_MESSAGE}}for(let t=0;t<n.ctrl_channels.length;t++){let i=n.ctrl_channels[t],p=findWithAttr(e,0,i.index);if(p>-1){let t=e[p][1],s=t[t.length-1];i.val=s*i.scale,isValidNumber(i.val)?i.str_val=i.val.toString().substring(0,i.disp.len)+" "+i.unit:i.str_val=App.WAIT_MESSAGE}}}}}function reset_display_variables(){App.server_time_string=App.WAIT_MESSAGE,App.data_timestamp=App.ntp.timestamp;let t=Display.data[App.display_index].screens[0];if(null!==t.time){App.display_is_static=!1;for(let e=0;e<t.channels.length;e++)t.channels[e].str_val=App.WAIT_MESSAGE}else App.display_is_static=!0}function mousePressed(){}function circle_button(t,e,i){dist(mouseX,mouseY,t,e);ellipseMode(CENTER),stroke(0,0),strokeWeight(i/4),stroke(0,0),ellipse(t,e,i,i)}function handle_display_data(t){Display.data=t.displays,void 0!==t.disp_timeout&&(App.display_timeout=t.disp_timeout),void 0!==t.disp_viewport_size&&(App.display_viewport=t.disp_viewport_size),void 0!==t.disp_kiosk_interval&&(App.display_kiosk_interval=t.disp_kiosk_interval),void 0!==t.disp_kiosk_adjust&&(App.display_kiosk_adjust=t.disp_kiosk_adjust),void 0!==t.disp_kiosk_override_height&&(App.display_kiosk_height=t.disp_kiosk_override_height),document.title="LabRemote",App.CONTAINER=document.getElementById("myContainer"),App.DISPLAY_SELECT=document.createElement("SELECT"),App.DISPLAY_SELECT.id="screen_select",App.CONTAINER.appendChild(App.DISPLAY_SELECT);for(let t=0;t<Display.data.length;t++)App.DISPLAY_SELECT.options[App.DISPLAY_SELECT.options.length]=new Option(Display.data[t].title,t);App.DISPLAY_SELECT.addEventListener("change",display_select_listener),setAttributes(App.DISPLAY_SELECT.style,{position:"absolute",left:"10px",top:"10px",visibility:"hidden"}),display_select_listener()}function label_listener(){let t=this;if(void 0!==t){App.hovered_clicked_label=t,t.style.visibility="visible";let[e,i]=getTagChannelIndex(t);if("timebkg"===e){let t=getChannelElement(["timelabel",null]);if(null!==t){t.style.visibility="visible";let e=Display.data[App.display_index].screens[0].time,i=e.str_val+e.info;t.innerHTML=i+(-App.ntp.adjustment/1e6).toString().substring(0,7)+" s"}}let p=getChannelElement(["setval",i]);if(null!==p){p.style.visibility="visible";let t=Display.data[App.display_index].screens[0].ctrl_channels,e=t[findWithAttr(t,"index",parseInt(i))],s="",n=(s=""!==e.str_val?e.str_val:(e.val*e.scale).toString().substring(0,e.disp.len)+" "+e.unit)+e.info;p.innerHTML=n;let l=getChannelElement(["slider",i]);null!==l&&(l.style.visibility="visible",l.value=e.val);let a=getChannelElement(["send",i]);null!==a&&(a.style.visibility="visible")}let s=getChannelElement(["label",i]);if(null!==s){s.style.visibility="visible";let t=Display.data[App.display_index].screens[0].channels,e=t[findWithAttr(t,"index",parseInt(i))],p="",n=(p=e.val.toString().substring(0,App.MAX_DISPLAY_DIGITS)+" "+e.unit)+e.info;s.innerHTML=n}}}function outside_label_listener(){let t=this;if(void 0!==t){App.hovered_clicked_label=null,t.style.visibility="hidden";let[e,i]=getTagChannelIndex(t);if("timebkg"===e){let t=getChannelElement(["timelabel",null]);if(null!==t){let e=Display.data[App.display_index].screens[0].time.str_val;t.innerHTML=e+htmlSpaces(0)+"<br>"+htmlSpaces(10)}}let p=getChannelElement(["send",i]);null!==p&&(p.style.visibility="hidden");let s=getChannelElement(["slider",i]);null!==s&&(s.style.visibility="hidden");let n=getChannelElement(["setval",i]);if(null!==n){let t=Display.data[App.display_index].screens[0].ctrl_channels,e=t[findWithAttr(t,"index",parseInt(i))],p="";p=""!==e.str_val?e.str_val:(e.val*e.scale).toString().substring(0,e.disp.len)+" "+e.unit,n.innerHTML=p+htmlSpaces(0)+"<br>"+htmlSpaces(10)}let l=getChannelElement(["label",i]);if(null!==l){let t=Display.data[App.display_index].screens[0].channels,e=t[findWithAttr(t,"index",parseInt(i))],p="";p=""!==e.str_val?e.str_val:(e.val*e.scale).toString().substring(0,e.disp.len)+" "+e.unit,l.innerHTML=p+htmlSpaces(0)+"<br>"+htmlSpaces(10)}}}function send_listener(){let t=this;void 0!==t&&(t.disabled=!0,t.style.opacity="0.5",App.pressed_send=t)}function slider_listener(){let t=this;if(void 0!==t){let[e,i]=getTagChannelIndex(t),p=getChannelElement(["setval",i]),s=getChannelElement(["send",i]),n=parseInt(i),l=parseFloat(t.value);s.disabled=!1,s.style.opacity="1.0";let a=[],_=Display.data[App.display_index].screens[0].ctrl_channels;for(let t=0;t<_.length;t++)_[t].index===n&&(a=_[t]);let r="";""!==a.min_str_val&&""!==a.max_str_val&&""!==a.str_val?(r=a.min_str_val,l>.5&&(r=a.max_str_val)):r=(l*a.scale).toString().substring(0,a.disp.len)+" "+a.unit,a.str_val=r,a.val=l,r+=a.info,p.innerHTML=r,App.moved_slider=t}}function display_select_listener(){if(background(255),0===App.display_kiosk_interval)App.frames_active=0;else{let t=App.display_kiosk_adjust;window.scrollTo(App.CANVAS_POS_X+t.x,App.CANVAS_POS_Y+t.y)}App.channel_strings_array=[],removeAllElements(App.CONTAINER),App.display_index=parseInt(App.DISPLAY_SELECT.options[App.DISPLAY_SELECT.selectedIndex].value);let t=Display.data[App.display_index].screens[0],e=t.imgs.length;if(e>0)for(let i=0;i<e;i++){let e=t.imgs[i];if(0===i&&(App.img_url=App.FILES_URL+e.file.toString()),App.img=loadImage(App.img_url,handle_image_loaded),"center"!==e.disp.pos&&(App.canvas_shift_x=e.disp.pos.x,App.canvas_shift_y=e.disp.pos.y),"source"!==e.dim){let t=e.dim.w,i=e.dim.h,p=i/e.disp.h;App.display_img_scale=e.disp.h/App.STD_SCALE_HEIGHT,App.display_kiosk_height>0&&(p=i/App.display_kiosk_height),App.img_height=i/p,App.img_width=t/p}}else App.img_url=App.FILES_URL+"00.jpg",App.img=loadImage(App.img_url,handle_image_loaded);App.DISPLAY_INFO_TEXT=document.createElement("DIV"),App.CONTAINER.appendChild(App.DISPLAY_INFO_TEXT),setAttributes(App.DISPLAY_INFO_TEXT.style,{width:parseInt(App.img_width).toString()+"px",height:parseInt(App.WARNING_FONTSIZE).toString()+"px",position:"absolute",left:parseInt(App.CANVAS_POS_X+App.canvas_shift_x+Math.max(App.img_width/2-7*App.WARNING_FONTSIZE,0)).toString()+"px",top:parseInt(App.CANVAS_POS_Y+App.canvas_shift_y+App.img_height/2-App.WARNING_FONTSIZE/2).toString()+"px",fontSize:parseInt(App.WARNING_FONTSIZE*App.display_img_scale).toString()+"px",fontFamily:App.all_font_families,textAlign:"left",visibility:"hidden"}),App.DISPLAY_INFO_TEXT.id="infotext";let i=t.time;if(null!==i){App.time_bins=i.bins,App.time_bin_size=i.bin_size;let t=i.disp,e=t.col,p=t.bgcol,s=document.createElement("DIV");App.CONTAINER.appendChild(s);let n=document.createElement("BUTTON");s.appendChild(n),n.innerHTML="";let l=document.createTextNode("");n.appendChild(l),s.title="",setAttributes(s.style,{width:(14.1*t.size).toString()+"px",height:(4.1*t.size+4).toString()+"px",position:"absolute",left:(t.pos.x*App.display_img_scale+App.CANVAS_POS_X+App.canvas_shift_x-t.size/2+1).toString()+"px",top:(t.pos.y*App.display_img_scale+App.CANVAS_POS_Y+App.canvas_shift_y-t.size+1).toString()+"px",visibility:"hidden",fontSize:parseInt(t.size*App.display_img_scale).toString()+"px",fontFamily:App.all_font_families,color:getRGBALiteral([e.r,e.g,e.b,e.a]),backgroundColor:getRGBALiteral([p.r,p.g,p.b,p.a])}),n.title="",setAttributes(n.style,{position:"absolute",left:(.33*t.size).toString()+"px",top:(.34*t.size).toString()+"px",visibility:"visible",fontSize:parseInt(t.size*App.display_img_scale).toString()+"px",fontFamily:App.all_font_families,color:getRGBALiteral([e.r,e.g,e.b,e.a]),backgroundColor:"transparent",border:"transparent",outline:"none",textAlign:"left"}),s.id="timebkg",n.id="timelabel",s.addEventListener("mouseover",label_listener),s.addEventListener("mouseleave",outside_label_listener),i.info=htmlSpaces(0)+"<br>Last server response (NTP)<br>Client time offset: ",i.padding=htmlSpaces(5)+"<br>"+htmlSpaces(10)}let p=t.channels.length;App.chan_index_string="";for(let e=0;e<p;e++){let i=t.channels[e],p=i.disp,s=p.bgcol,n=p.col,l=i.index.toString();App.chan_index_string+=l+";";let a=document.createElement("DIV");App.CONTAINER.appendChild(a);let _=document.createElement("BUTTON");a.appendChild(_),_.innerHTML="";let r=document.createTextNode("");_.appendChild(r),a.title="",setAttributes(a.style,{width:(13.9*p.size).toString()+"px",height:(4.1*p.size+4).toString()+"px",position:"absolute",left:(p.pos.x*App.display_img_scale+App.CANVAS_POS_X+App.canvas_shift_x-p.size/2+1).toString()+"px",top:(p.pos.y*App.display_img_scale+App.CANVAS_POS_Y+App.canvas_shift_y-p.size+1).toString()+"px",visibility:"hidden",fontSize:parseInt(p.size*App.display_img_scale).toString()+"px",fontFamily:App.all_font_families,color:getRGBALiteral([n.r,n.g,n.b,n.a]),backgroundColor:getRGBALiteral([s.r,s.g,s.b,s.a])}),_.title="",setAttributes(_.style,{position:"absolute",left:(.33*p.size).toString()+"px",top:(.34*p.size).toString()+"px",visibility:"visible",fontSize:parseInt(p.size*App.display_img_scale).toString()+"px",fontFamily:App.all_font_families,color:getRGBALiteral([n.r,n.g,n.b,n.a]),backgroundColor:"transparent",border:"transparent",outline:"none",textAlign:"left"}),a.id="chanbkg_"+l,_.id="label_"+l,a.addEventListener("mouseover",label_listener),a.addEventListener("mouseleave",outside_label_listener),i.info=htmlSpaces(0)+"<br>"+i.label.toString()+"<br>Measurement channel "+l,i.padding=htmlSpaces(5)+"<br>"+htmlSpaces(10)}let s=t.img_channels.length;App.img_chan_index_string="";for(let e=0;e<s;e++){let i=t.img_channels[e],p=i.index.toString();if(App.img_chan_index_string+=p+";","center"!==i.disp.pos&&(App.canvas_shift_x=i.disp.pos.x,App.canvas_shift_y=i.disp.pos.y),"source"!==i.dim){let t=i.dim.w,e=i.dim.h,p=e/i.disp.h;App.display_img_scale=i.disp.h/App.STD_SCALE_HEIGHT,App.display_kiosk_height>0&&(p=e/App.display_kiosk_height),App.img_height=e/p,App.img_width=t/p}}let n=t.ctrl_channels.length;App.ctrl_chan_index_string="";for(let e=0;e<n;e++){let i=t.ctrl_channels[e],p=i.index.toString();App.ctrl_chan_index_string+=p+";";let s=document.createElement("DIV");App.CONTAINER.appendChild(s);let n=document.createElement("INPUT"),l=document.createElement("BUTTON"),a=document.createElement("BUTTON");s.appendChild(n),s.appendChild(l),s.appendChild(a);let _=document.createTextNode("");l.appendChild(_),s.id="ctrlbkg_"+p,n.id="slider_"+p,l.id="setval_"+p,a.id="send_"+p,s.addEventListener("mouseover",label_listener),s.addEventListener("mouseleave",outside_label_listener);let r=i.disp,A=r.col,d=r.bgcol;s.title="",setAttributes(s.style,{width:(10.8*r.size).toString()+"px",height:(8.2*r.size).toString()+"px",position:"absolute",left:(r.pos.x*App.display_img_scale+App.CANVAS_POS_X+App.canvas_shift_x-r.size/2+7).toString()+"px",top:(r.pos.y*App.display_img_scale+App.CANVAS_POS_Y+App.canvas_shift_y-r.size+14).toString()+"px",visibility:"hidden",fontSize:parseInt(r.size*App.display_img_scale).toString()+"px",fontFamily:App.all_font_families,color:getRGBALiteral([A.r,A.g,A.b,A.a]),backgroundColor:getRGBALiteral([d.r,d.g,d.b,d.a])}),n.title="",setAttributes(n.style,{width:(9*r.size).toString()+"px",height:(1.8*r.size).toString()+"px",position:"absolute",left:(.7*r.size).toString()+"px",top:(.6*r.size).toString()+"px",visibility:"hidden",fontSize:parseInt(r.size*App.display_img_scale).toString()+"px",fontFamily:App.all_font_families}),l.title="",setAttributes(l.style,{position:"absolute",left:(.38*r.size).toString()+"px",top:(3*r.size).toString()+"px",visibility:"visible",fontSize:parseInt(r.size*App.display_img_scale).toString()+"px",fontFamily:App.all_font_families,color:getRGBALiteral([A.r,A.g,A.b,A.a]),backgroundColor:"transparent",border:"transparent",outline:"none",textAlign:"left"}),a.title="",a.disabled=!0,setAttributes(a.style,{width:(2.7*r.size).toString()+"px",height:(1.6*r.size).toString()+"px",position:"absolute",left:(7.3*r.size).toString()+"px",top:(3.1*r.size).toString()+"px",visibility:"hidden",fontSize:parseInt(r.size*App.display_img_scale).toString()+"px",fontFamily:App.all_font_families,borderRadius:"10%",opacity:"0.5",textAlign:"center"}),setAttributes(n,{type:"range",min:i.min_val,max:i.max_val,step:i.val_step,value:i.val}),n.addEventListener("input",slider_listener);let o="";""!==i.min_str_val&&""!==i.max_str_val&&""!==i.str_val?(setAttributes(n,{min:0,max:1,step:1,value:0}),o=i.min_str_val):o=(i.val*i.scale).toString().substring(0,i.disp.len)+" "+i.unit,setAttributes(i,{str_val:o,info:htmlSpaces(0)+"<br>"+htmlSpaces(10)+"<br>"+i.label.toString()+"<br>Control channel "+p,padding:htmlSpaces(0)+"<br>"+htmlSpaces(10)+"<br>"+htmlSpaces(10)}),l.innerHTML=o+i.padding,a.addEventListener("click",send_listener),a.innerHTML="Go"}reset_display_variables()}